---
icon: akar-icons:file
date: 2025-08-21
order: 7
category:
  - Utils
---

# EventBus

```typescript
import {createUUID} from '@utils'

interface EventType {
    id: number
    eventName: string
    eventFnc: EventFnc
    once: boolean
}

interface EventFnc {
    (...args: any): void
}

export interface EventBusOption {
    immediate?: boolean
    once?: boolean
}

export interface EventBusProps {
    $on(eventName: string, callback: EventFnc, option?: EventBusOption): number

    $emit(eventName: string, ...args: any): void

    $off(eventName?: string | Array<string>): void

    $once(eventName: string, callback: EventFnc): void
}

export default class EventBus implements EventBusProps {
    private _eventList: Array<EventType> = []

    /**
     * 监听
     * @param {string} eventName 需要监听的名字
     * @param {Function} callback 监听触发的回调
     * @param option
     * */
    public $on(eventName: string, callback: EventFnc, option?: EventBusOption): number {
        const events: Array<EventType> = this._findEvent(eventName)
        // 对比callback引用是否存在

        const event: UndefinedAble<EventType> = events?.find((event: EventType) => {
            return event.eventFnc === callback && event.eventName === eventName
        })
        let resultId
        if (!event) {
            // 如果没有事件，需要往list中加一个
            resultId = this._addEvent(eventName, callback)
        } else {
            resultId = event.id
        }
        option?.immediate && callback('')
        return resultId
    }

    /**
     * 分发事件
     * @param {string} eventName 需要分发的监听的名字
     * @param { any } args 传递的参数
     * */
    // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
    public $emit(eventName: string, ...args: any): Promise<void | void[]> {
        const events: Array<EventType> = this._findEvent(eventName)
        if (events.length) {
            return Promise.all(
                events.map((eventType: EventType) => {
                    eventType.eventFnc(...args)
                    //once 执行一次就清除
                    eventType.once && this.$off(eventType.id)
                })
            )
        }
        return Promise.resolve()
    }

    /**
     * 取消监听
     * @param {string | Array<string>} eventName 需要取消的监听名称
     * */
    public $off(eventName?: string | number | Array<string> | Array<number>): void {
        if (typeof eventName === 'string') {
            this._eventList = this._eventList.filter(event => event.eventName !== eventName)
        } else if (typeof eventName === 'number') {
            const index: number = this._eventList.findIndex((event: EventType) => event.id === eventName)
            if (index > -1) this._eventList.splice(index, 1)
        } else if (eventName instanceof Array) {
            eventName.map(m => this.$off(m))
        } else {
            this._eventList = []
        }
    }

    /**
     * 执行一次的监听之后立即销毁
     * @param {string} eventName 需要监听的名字
     * @param {Function} callback 监听触发的回调
     * */
    public $once(eventName: string, callback: EventFnc): void {
        this.$on(eventName, callback, {once: true})
    }

    private _findEvent(eventName: string): Array<EventType> {
        return this._eventList.filter((event: EventType) => event.eventName === eventName)
    }

    private _addEvent(eventName: string, callback: EventFnc, once = false): number {
        const id = createUUID()
        this._eventList.push({
            id: id,
            eventName,
            eventFnc: callback,
            once
        })
        return id
    }
}
```